# 📁 Godot 3Dマルチプレイヤーゲーム - 最終ファイル構成

```
ProjectRoot/
├── project.godot
├── export_presets.cfg
│
├── assets/                          # 素材
│   ├── models/
│   │   ├── characters/
│   │   │   ├── character_01.glb     # キャラクター1
│   │   │   ├── character_02.glb     # キャラクター2
│   │   │   ├── character_03.glb     # キャラクター3
│   │   │   └── character_04.glb     # キャラクター4
│   │   ├── environments/
│   │   │   ├── town_buildings.glb
│   │   │   ├── forest_props.glb
│   │   │   └── beach_props.glb
│   │   └── ui_icons/
│   │       ├── settings_icon.png
│   │       ├── chat_icon.png
│   │       └── character_icons.png
│   │
│   ├── textures/
│   │   ├── characters/
│   │   │   ├── skin_colors/        # 肌色バリエーション
│   │   │   │   ├── light_skin.png
│   │   │   │   ├── medium_skin.png
│   │   │   │   └── dark_skin.png
│   │   │   ├── hair_colors/        # 髪色バリエーション
│   │   │   │   ├── brown_hair.png
│   │   │   │   ├── blonde_hair.png
│   │   │   │   └── black_hair.png
│   │   │   └── outfit_colors/      # 服色バリエーション
│   │   │       ├── blue_outfit.png
│   │   │       ├── red_outfit.png
│   │   │       └── green_outfit.png
│   │   └── environments/
│   │       ├── grass_texture.png
│   │       └── stone_texture.png
│   │
│   ├── audio/
│   │   ├── bgm/
│   │   │   ├── town_theme.ogg
│   │   │   ├── forest_theme.ogg
│   │   │   └── menu_theme.ogg
│   │   └── sfx/
│   │       ├── footsteps.ogg
│   │       ├── ui_click.ogg
│   │       └── notification.ogg
│   │
│   └── fonts/
│       ├── ui_font_regular.ttf      # メインUI用
│       ├── ui_font_bold.ttf         # 見出し用
│       └── name_tag_font.ttf        # 名前表示用
│
├── scenes/                          # シーン
│   ├── Main.tscn                    # メインシーン（起動時）
│   │
│   ├── player/
│   │   ├── Player.tscn              # 自分のプレイヤー
│   │   ├── RemotePlayer.tscn        # 他プレイヤー
│   │   ├── CharacterCustomizer.tscn # キャラカスタマイズ（3D）
│   │   └── NameTag.tscn            # 名前表示（3D空間）
│   │
│   ├── maps/
│   │   ├── MainTown.tscn
│   │   ├── ForestArea.tscn
│   │   ├── BeachArea.tscn
│   │   ├── MountainArea.tscn
│   │   └── rooms/
│   │       ├── PrivateRoom.tscn
│   │       └── TrainingRoom.tscn
│   │
│   ├── ui/                          # UI（2D）
│   │   ├── screens/                 # 全画面UI
│   │   │   ├── LoginScreen.tscn     # ログイン画面
│   │   │   ├── CharacterSelection.tscn # キャラ選択画面
│   │   │   ├── SettingsScreen.tscn  # 設定画面
│   │   │   └── LoadingScreen.tscn   # ローディング画面
│   │   ├── panels/                  # ゲーム内パネル
│   │   │   ├── MainGameUI.tscn      # ゲーム内メインUI
│   │   │   ├── ChatPanel.tscn       # チャットパネル
│   │   │   ├── MapMenu.tscn         # マップ選択
│   │   │   ├── TrainingMenu.tscn    # 研修メニュー
│   │   │   └── RoomInvite.tscn      # ルーム招待
│   │   └── components/              # 再利用UIコンポーネント
│   │       ├── ColorPicker.tscn     # 色選択
│   │       ├── ModelViewer.tscn     # 3Dモデル表示
│   │       └── UserCard.tscn        # ユーザー情報カード
│   │
│   └── world_objects/               # ワールドオブジェクト
│       ├── MapPortal.tscn           # マップ移動ポータル
│       ├── InteractArea.tscn        # インタラクション範囲
│       ├── TrainingTerminal.tscn    # 研修端末
│       └── ChatBubble.tscn          # チャット吹き出し
│
├── scripts/                         # スクリプト
│   ├── singletons/                  # AutoLoadシングルトン
│   │   ├── Game.gd                  # ゲーム状態・ユーザー管理
│   │   ├── Net.gd                   # 通信管理
│   │   ├── Chat.gd                  # チャット管理
│   │   └── Audio.gd                 # 音声管理
│   │
│   ├── player/
│   │   ├── PlayerController.gd      # プレイヤー制御（移動・カメラ）
│   │   ├── PlayerSync.gd           # ネットワーク同期
│   │   ├── PlayerAnimationController.gd # アニメーション制御
│   │   ├── CharacterSelector.gd    # キャラクター選択ロジック
│   │   └── NameTagController.gd    # 名前表示制御
│   │
│   ├── maps/
│   │   ├── BaseMap.gd              # 共通マップ機能
│   │   ├── MainTown.gd             # タウン固有処理
│   │   ├── ForestArea.gd           # 森エリア固有処理
│   │   └── PrivateRoom.gd          # プライベートルーム
│   │
│   ├── ui/
│   │   ├── screens/                # 画面制御
│   │   │   ├── LoginScreen.gd
│   │   │   ├── CharacterSelection.gd
│   │   │   ├── SettingsScreen.gd   # 設定画面制御
│   │   │   └── LoadingScreen.gd
│   │   ├── panels/                 # パネル制御
│   │   │   ├── MainGameUI.gd
│   │   │   ├── ChatPanel.gd
│   │   │   └── MapMenu.gd
│   │   └── components/             # コンポーネント制御
│   │       ├── ColorPicker.gd
│   │       └── ModelViewer.gd
│   │
│   ├── core/                       # コアシステム
│   │   ├── DataTypes.gd            # データ構造定義
│   │   ├── Constants.gd            # 定数定義
│   │   ├── AnimationStates.gd      # アニメーション状態定義
│   │   ├── Utils.gd               # 汎用関数
│   │   ├── SaveSystem.gd          # セーブ/ロード
│   │   └── SettingsData.gd        # 設定データ管理
│   │
│   ├── network/                    # ネットワーク詳細
│   │   ├── GraphQLQueries.gd      # GraphQLクエリ定義
│   │   ├── WebSocketHandler.gd    # WebSocket処理
│   │   └── AuthManager.gd         # 認証管理
│   │
│   └── world_objects/
│       ├── MapPortal.gd
│       ├── InteractArea.gd
│       └── TrainingTerminal.gd
│
├── data/                           # データファイル
│   ├── character_list.json        # 利用可能キャラクターリスト
│   ├── animation_config.json      # アニメーション設定
│   ├── server_config.json         # サーバー設定
│   ├── ui_themes.tres             # UIテーマ
│   └── local/                     # ローカルデータ
│       ├── user_settings.save     # ユーザー設定
│       ├── selected_character.save # 選択中キャラクター
│       ├── game_progress.save     # ゲーム進行状況
│       └── chat_cache.dat         # チャット履歴
│
└── materials/                      # マテリアル
    ├── character_materials/
    │   ├── skin_materials.tres
    │   ├── hair_materials.tres
    │   └── outfit_materials.tres
    ├── environment_materials/
    │   ├── ground_materials.tres
    │   └── building_materials.tres
    └── ui_materials/
        └── ui_stylebox.tres
```

## 🔧 AutoLoad設定（Project Settings > AutoLoad）

```
Game    - scripts/singletons/Game.gd     # ユーザー情報、キャラデータ、シーン管理
Net     - scripts/singletons/Net.gd      # GraphQL、WebSocket通信
Chat    - scripts/singletons/Chat.gd     # チャット機能
Audio   - scripts/singletons/Audio.gd    # BGM、SE管理
```

## 📝 主要機能の対応

### キャラクター設定
- **CharacterCreation.tscn**: 初回キャラ作成画面（2D UI）
- **CharacterCustomizer.tscn**: 3Dプレビュー付きカスタマイズ
- **CharacterData.gd**: キャラクター情報（髪型、服装、色）の管理
- **character_presets.json**: デフォルトキャラクター設定

### 名前表示
- **NameTag.tscn**: 3D空間での名前表示（プレイヤー頭上）
- **NameTagController.gd**: 距離による表示制御、カメラ追従
- **UserCard.tscn**: プレイヤー情報カード（詳細表示）

### 設定画面（2D）
- **SettingsScreen.tscn**: 全画面設定UI
- **SettingsData.gd**: 音量、画質、操作設定管理
- **user_settings.save**: ローカル設定保存

## 🎮 ゲームフロー

```
起動（Main.tscn）
↓
LoginScreen.tscn（ログイン）
↓
CharacterCreation.tscn（初回のみ）
↓
MainTown.tscn（ゲーム開始）
│
├── SettingsScreen.tscn（ESCキーでアクセス）
├── ChatPanel.tscn（常時表示可能）
└── TrainingMenu.tscn（端末から）
```

## 🔄 データの流れ

1. **起動時**: `Game.gd` がローカル設定とキャラデータを読込
2. **ログイン後**: `Net.gd` でサーバー認証、ユーザー情報取得
3. **ゲーム中**: `PlayerSync.gd` で位置・アクション同期
4. **チャット**: `Chat.gd` でリアルタイム送受信

この構成で確定しますか？