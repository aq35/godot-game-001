了解！提案した最小構成で、**各ファイルの役割**を一気に把握できるようにまとめます。
まずは「Autoload（常駐ロジック）」→「UIシーン」→「3Dシーン」→「最上位/その他」の順です。

---

# 🔧 Autoload（シングルトン：常駐ロジック）

## `autoload/App.gd`

* **役割**: 画面（シーン）遷移の中枢。現在のシーンの生成・破棄を一元管理。
* **主なAPI**: `change_scene(path:String)`
* **ポイント**: フェード演出やローディング表示を足すならここに。

## `autoload/Auth.gd`

* **役割**: 認証状態管理（JWT・ユーザー情報・ログイン/ログアウト）。
* **シグナル**: `logged_in`, `logged_out`
* **主なAPI**: `login(name, password)`, `logout()`
* **ポイント**: トークン期限切れ時の挙動（再ログイン誘導）もここで統一。

## `autoload/Api.gd`

* **役割**: HTTP通信の薄いクライアント。`Auth.jwt` を見てヘッダ付与。
* **主なAPI**: `get_json(path)`, `post_json(path, body)`
* **ポイント**: リトライ/タイムアウト/共通エラーハンドリングを後で拡張。

## `autoload/NotesStore.gd`

* **役割**: ローカルノートの保存・読み込み（`user://`配下、JSON）。
* **主なAPI**: `list()`, `save_note(note)`, `load_all()`
* **ポイント**: 後で画像添付・タグ・検索などを足す土台。

## `autoload/RoomClient.gd`

* **役割**: マルチプレイ通信用ラッパ（WebSocket + RPC）。移動/チャット同期。
* **シグナル（UiBusへ委譲）**: `chat_message`, `remote_move`
* **主なAPI**: `connect_room()`, `send_move(...)`, `send_chat(msg)`
* **ポイント**: 送信レート制御・補間・信頼性（unreliable/order）をここで吸収。

## `autoload/UserPrefs.gd`

* **役割**: ユーザー設定（音量・言語など）の読み書き（`ConfigFile`）。
* **主なAPI**: `load_prefs()`, `save_prefs()`
* **ポイント**: 設定UIから直接ここを呼ぶと分かりやすい。

## `autoload/UiBus.gd`

* **役割**: UI向けイベントの集約バス（疎結合にするハブ）。
* **シグナル**: `toast(msg)`, `chat_message(sender, msg)`, `remote_move(id,pos,rot,state)`
* **ポイント**: 「どこからでもUIに通知」を可能にする。

---

# 🖼️ UIシーン（2D）

## `scenes/ui/Login.tscn` + `Login.gd`

* **役割**: ログイン画面。認証リクエストを投げ、成功時に画面遷移。
* **依存**: `Auth.logged_in` を購読 → `App.change_scene(MainMenu)`
* **ポイント**: 外部OAuthリンクを追加するなら `OS.shell_open()` を使用。

## `scenes/ui/MainMenu.tscn` + `MainMenu.gd`

* **役割**: 入口メニュー。各画面（Training/Notes/Room/Settings/Logout）のハブ。
* **依存**: `App`（シーン遷移）, `UserPrefs`（保存）
* **ポイント**: メニュー増減や通知の設置はここから。

## `scenes/ui/TrainingList.tscn` + `TrainingList.gd`

* **役割**: 研修課題一覧の取得と表示。選択した課題を外部ブラウザで開く。
* **依存**: `Api.get_json("/trainings")`
* **ポイント**: 将来は詳細表示・進捗更新・検索/並び替えを追加。

## `scenes/ui/Notes.tscn` + `Notes.gd`

* **役割**: ローカルノートの一覧・編集・保存。
* **依存**: `NotesStore.list() / save_note()`
* **ポイント**: まずはプレーンテキストで“薄く完成”。画像やMarkdownは後で。

---

# 🌐 3Dシーン

## `scenes/room/Room3D.tscn` + `Room3D.gd`

* **役割**: コミュニティ空間（個人/共有ルーム共通）。入室・チャット・移動同期の受け口。
* **依存**: `RoomClient.connect_room()`, `UiBus.chat_message/remote_move`
* **ポイント**: UIは `CanvasLayer` を直下に置く（3DとZ競合しないように）。

## `scenes/room/Player.tscn`

* **役割**: 自キャラ。入力→移動→アニメーション制御（後で差し替えOK）。
* **構成**: `CharacterBody3D + CollisionShape3D + (Mesh/Skeleton) + AnimationPlayer + AnimationTree`
* **ポイント**: 速度パラメータで `BlendSpace1D` 駆動（Idle/Walk/Run）。接地判定でJump/Fall/Land。

## `scenes/room/RemotePlayer.tscn`

* **役割**: 他プレイヤーの見た目を表示・補間。入力はしない、見せるだけ。
* **依存**: `UiBus.remote_move` を受けて位置・向き・状態を更新。
* **ポイント**: 所有権（authority）を持たないこと。レンダのみ。

---

# 🧱 最上位/その他

## `game.tscn`

* **役割**: プロジェクトのエントリ（空の `Node` でOK）。`run/main_scene` がここを指す。
* **依存**: `App.gd` がここから最初のシーンを差し込む。
* **ポイント**: スプラッシュやグローバルUIを置きたいならここに。

## `project.godot`

* **役割**: プロジェクト設定（起動シーン、解像度、入力、Autoload、レンダリング等）。
* **ポイント**: 基本は **エディタUIから編集**（直接編集はバックアップ前提）。

---

# 🤝 ファイル間の関係（超要約）

* `Login.gd` → `Auth.login()` → 成功で `Auth.logged_in` → `App.change_scene(MainMenu)`
* `TrainingList.gd` → `Api.get_json()` → `OS.shell_open(url)`
* `Notes.gd` → `NotesStore.list/save_note`
* `Room3D.gd` → `RoomClient.connect_room()`
  チャット送信: `RoomClient.send_chat()`
  受信表示: `UiBus.chat_message` → `Room3D.gd`
  移動同期: （自）`RoomClient.send_move`／（他）`UiBus.remote_move` → `RemotePlayer` 更新

---

# 🛡️ 変更時のガイド

* **UI/フロー変更** → `App.gd` と該当UIシーンの `*.gd`
* **API仕様変更** → `Api.gd`（ヘッダ/BASE/共通エラー）
* **認証仕様変更** → `Auth.gd`（JWT・再認証）
* **ローカル保存拡張** → `NotesStore.gd`（スキーマ、マイグレ風に）
* **マルチプレイ挙動** → `RoomClient.gd`（送信頻度、補間、RPC信頼度）
* **ユーザー設定** → `UserPrefs.gd`（ロード/セーブとUIの紐付け）

---

必要なら、どれか\*\*1ファイルを詳細設計（関数一覧＋ダミー実装＋コメント）\*\*まで落とし込みます。
次に深掘りしたいのはどれ？（例：`Player` の移動＋アニメ、`RoomClient` の補間、`Api` の共通エラー設計 など）
