#!/bin/bash

# =============================================================================
# Godot 3Dマルチプレイヤーゲーム プロジェクト構造作成
# 使用方法: chmod +x setup_project.sh && ./setup_project.sh
# =============================================================================

PROJECT_NAME="multiplayer_3d_game"

echo "🚀 Godotプロジェクト構造を作成中..."

# プロジェクトルートディレクトリ作成
mkdir -p $PROJECT_NAME
cd $PROJECT_NAME

# =============================================================================
# 📁 ディレクトリ構造作成
# =============================================================================

echo "📁 ディレクトリ構造作成中..."

# AutoLoadディレクトリ
mkdir -p autoload

# アセットディレクトリ
mkdir -p assets/characters/{models,textures,animations}
mkdir -p assets/environments/{models,textures,materials}
mkdir -p assets/ui/{icons/character_icons,icons/ui_icons,icons/room_icons,themes,fonts}
mkdir -p assets/audio/{bgm,sfx/{ui_sounds,footsteps,ambient}}

# シーンディレクトリ
mkdir -p scenes/main
mkdir -p scenes/player/components
mkdir -p scenes/worlds/{private_rooms,components}
mkdir -p scenes/ui/{screens,hud,dialogs,components}
mkdir -p scenes/effects/particles

# スクリプトディレクトリ
mkdir -p scripts/core
mkdir -p scripts/network
mkdir -p scripts/player
mkdir -p scripts/rooms
mkdir -p scripts/chat
mkdir -p scripts/training
mkdir -p scripts/ui/components

# データディレクトリ
mkdir -p data/{config,localization,cache}

# その他ディレクトリ
mkdir -p addons/{custom_networking,ui_extensions}
mkdir -p tools/{build_scripts,asset_pipeline,debugging}
mkdir -p tests/{unit,integration,test_helpers}
mkdir -p docs

echo "✅ ディレクトリ構造作成完了"

# =============================================================================
# 📄 基本ファイル作成
# =============================================================================

echo "📄 基本ファイル作成中..."

# プロジェクト設定ファイル
cat > project.godot << 'EOF'
; Engine configuration file.
; It's best edited using the editor UI and not directly,
; since the parameters that go here are not all obvious.
;
; Format:
;   [section] ; section goes between []
;   param=value ; assign values to parameters

config_version=5

[application]

config/name="3D Multiplayer Game"
run/main_scene="res://scenes/main/Main.tscn"
config/features=PackedStringArray("4.4", "GL Compatibility")

[autoload]

Game="*res://autoload/Game.gd"
Net="*res://autoload/Net.gd"
Audio="*res://autoload/Audio.gd"
Chat="*res://autoload/Chat.gd"
Rooms="*res://autoload/Rooms.gd"
Settings="*res://autoload/Settings.gd"
EventBus="*res://scripts/core/EventBus.gd"

[input]

move_forward={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":87,"key_label":0,"unicode":119,"echo":false,"script":null)
]
}
move_backward={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":83,"key_label":0,"unicode":115,"echo":false,"script":null)
]
}
move_left={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":65,"key_label":0,"unicode":97,"echo":false,"script":null)
]
}
move_right={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":68,"key_label":0,"unicode":100,"echo":false,"script":null)
]
}
jump={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":32,"key_label":0,"unicode":32,"echo":false,"script":null)
]
}
action_wave={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":49,"key_label":0,"unicode":49,"echo":false,"script":null)
]
}
action_dance={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":50,"key_label":0,"unicode":50,"echo":false,"script":null)
]
}
action_sit={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":51,"key_label":0,"unicode":51,"echo":false,"script":null)
]
}
chat_toggle={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":84,"key_label":0,"unicode":116,"echo":false,"script":null)
]
}
menu_toggle={
"deadzone": 0.0,
"events": [Object(InputEventKey,"resource_local_to_scene":false,"resource_name":"","device":-1,"window_id":0,"alt_pressed":false,"shift_pressed":false,"ctrl_pressed":false,"meta_pressed":false,"pressed":false,"keycode":0,"physical_keycode":4194305,"key_label":0,"unicode":0,"echo":false,"script":null)
]
}

[rendering]

renderer/rendering_method="gl_compatibility"
renderer/rendering_method.mobile="gl_compatibility"
EOF

# .gitignore
cat > .gitignore << 'EOF'
# Godot 4+
.godot/
.import/

# Godot-specific ignores
override.cfg
export_presets.cfg
export.cfg

# システム関連
.DS_Store
Thumbs.db

# ユーザーデータ
data/cache/
*.tmp
*.bak

# ビルド成果物
builds/
exports/

# IDE関連
.vscode/
.idea/

# ログファイル
*.log
logs/

# 一時ファイル
*~
.#*
\#*#
EOF

# README.md
cat > README.md << 'EOF'
# 3D Multiplayer Game

Godot 4.4で作成する3Dマルチプレイヤーゲーム

## 🎮 概要
- **エンジン**: Godot 4.4
- **バックエンド**: Go + GraphQL
- **通信**: WebSocket + GraphQL
- **世界観**: ポケモン風の平和な3D世界

## 🚀 機能
- [x] リアルタイムマルチプレイヤー
- [x] キャラクター選択
- [x] ルームシステム（パブリック/プライベート）
- [x] チャット機能
- [x] 研修システム連携

## 🏗️ プロジェクト構造
```
autoload/          # シングルトン
scenes/           # シーンファイル
scripts/          # スクリプト
assets/           # リソース
data/             # データファイル
```

## 🛠️ セットアップ
1. Godot 4.4をインストール
2. プロジェクトを開く
3. サーバー設定を行う（`data/config/server_config.json`）

## 📝 開発フロー
1. Phase 1: 基盤セットアップ ✅
2. Phase 2: 単体プレイヤー
3. Phase 3: ネットワーク基盤
4. Phase 4: マルチプレイヤー基礎
5. Phase 5: UI・UX機能
6. Phase 6: ルームシステム
7. Phase 7: 高度な機能
8. Phase 8: 最終調整

## 🔗 関連リンク
- [Godot Documentation](https://docs.godotengine.org/)
- [GraphQL](https://graphql.org/)
EOF

echo "✅ 基本ファイル作成完了"

# =============================================================================
# 📄 設定ファイル作成
# =============================================================================

echo "📄 設定ファイル作成中..."

# サーバー設定
cat > data/config/server_config.json << 'EOF'
{
  "development": {
    "graphql_url": "http://localhost:8080/graphql",
    "websocket_url": "ws://localhost:8080/ws",
    "api_key": "dev_api_key"
  },
  "production": {
    "graphql_url": "https://api.example.com/graphql", 
    "websocket_url": "wss://api.example.com/ws",
    "api_key": "prod_api_key"
  }
}
EOF

# キャラクター設定
cat > data/config/character_list.json << 'EOF'
{
  "characters": [
    {
      "id": 1,
      "name": "アリス",
      "model_path": "res://assets/characters/models/character_01.glb",
      "preview_path": "res://assets/ui/icons/character_icons/character_01_preview.png",
      "description": "元気で明るい女の子"
    },
    {
      "id": 2,
      "name": "ボブ", 
      "model_path": "res://assets/characters/models/character_02.glb",
      "preview_path": "res://assets/ui/icons/character_icons/character_02_preview.png",
      "description": "クールな青年"
    },
    {
      "id": 3,
      "name": "キャロル",
      "model_path": "res://assets/characters/models/character_03.glb", 
      "preview_path": "res://assets/ui/icons/character_icons/character_03_preview.png",
      "description": "知的な女性"
    },
    {
      "id": 4,
      "name": "デイブ",
      "model_path": "res://assets/characters/models/character_04.glb",
      "preview_path": "res://assets/ui/icons/character_icons/character_04_preview.png",
      "description": "優しい中年男性"
    }
  ]
}
EOF

# アニメーション設定
cat > data/config/animation_config.json << 'EOF'
{
  "animation_speeds": {
    "walk_threshold": 1.0,
    "run_threshold": 4.0,
    "animation_blend_speed": 5.0
  },
  "sync_settings": {
    "position_sync_rate": 10,
    "animation_sync_threshold": 0.1
  }
}
EOF

# UI設定
cat > data/config/ui_config.json << 'EOF'
{
  "chat": {
    "max_messages": 100,
    "message_fade_time": 5.0,
    "chat_bubble_duration": 3.0
  },
  "rooms": {
    "max_room_name_length": 50,
    "default_max_players": 20
  },
  "settings": {
    "default_master_volume": 0.8,
    "default_bgm_volume": 0.6,
    "default_sfx_volume": 0.8
  }
}
EOF

# キャッシュディレクトリのREADME
cat > data/cache/README.md << 'EOF'
# Cache Directory

このディレクトリにはゲーム実行時に生成される一時ファイルが保存されます。

- チャット履歴キャッシュ
- ダウンロード済みアセット
- 一時的なユーザーデータ

このディレクトリの内容は削除しても問題ありません。
EOF

echo "✅ 設定ファイル作成完了"

# =============================================================================
# 📄 プレースホルダーファイル作成
# =============================================================================

echo "📄 プレースホルダーファイル作成中..."

# 空のプレースホルダーファイルを作成（Godotがディレクトリを認識するため）
touch assets/characters/models/.gitkeep
touch assets/characters/textures/.gitkeep
touch assets/characters/animations/.gitkeep
touch assets/environments/models/.gitkeep
touch assets/environments/textures/.gitkeep
touch assets/environments/materials/.gitkeep
touch assets/ui/icons/character_icons/.gitkeep
touch assets/ui/icons/ui_icons/.gitkeep
touch assets/ui/icons/room_icons/.gitkeep
touch assets/ui/themes/.gitkeep
touch assets/ui/fonts/.gitkeep
touch assets/audio/bgm/.gitkeep
touch assets/audio/sfx/ui_sounds/.gitkeep
touch assets/audio/sfx/footsteps/.gitkeep
touch assets/audio/sfx/ambient/.gitkeep
touch addons/custom_networking/.gitkeep
touch addons/ui_extensions/.gitkeep
touch tools/build_scripts/.gitkeep
touch tools/asset_pipeline/.gitkeep
touch tools/debugging/.gitkeep
touch tests/unit/.gitkeep
touch tests/integration/.gitkeep
touch tests/test_helpers/.gitkeep

echo "✅ プレースホルダーファイル作成完了"

# =============================================================================
# 📄 開発用ドキュメント作成
# =============================================================================

echo "📄 開発用ドキュメント作成中..."

# アーキテクチャドキュメント
cat > docs/architecture.md << 'EOF'
# アーキテクチャ文書

## システム構成
- **クライアント**: Godot 4.4
- **サーバー**: Go + GraphQL + WebSocket
- **データベース**: PostgreSQL（推奨）

## レイヤー構造
1. Presentation Layer (UI/HUD)
2. Application Layer (AutoLoad)  
3. Domain Layer (Core Logic)
4. Infrastructure Layer (Network/Storage)

## 通信方式
- **GraphQL**: 静的データ取得（認証、ルーム一覧等）
- **WebSocket**: リアルタイム同期（位置、チャット等）

詳細は各フェーズの設計書を参照
EOF

# セットアップガイド
cat > docs/setup_guide.md << 'EOF'
# セットアップガイド

## 環境要件
- Godot 4.4以降
- Git
- テキストエディタ（VSCode推奨）

## プロジェクト初期化
1. このプロジェクトをクローンまたはダウンロード
2. Godotで`project.godot`を開く
3. `data/config/server_config.json`でサーバー設定
4. 初回実行でAutoLoadが読み込まれることを確認

## 開発の進め方
1. Phase 1: 基盤セットアップ ✅  
2. Phase 2: 単体プレイヤー
3. Phase 3: ネットワーク基盤
...

詳細は`README.md`を参照
EOF

echo "✅ 開発用ドキュメント作成完了"

# =============================================================================
# 🎉 完了メッセージ
# =============================================================================

echo ""
echo "🎉 プロジェクト構造作成完了！"
echo ""
echo "📊 作成された内容:"
echo "   📁 ディレクトリ: $(find . -type d | wc -l) 個"
echo "   📄 ファイル: $(find . -type f | wc -l) 個"
echo ""
echo "🚀 次のステップ:"
echo "   1. Godotで '$PROJECT_NAME/project.godot' を開く"
echo "   2. AutoLoad設定が正しく読み込まれることを確認"
echo "   3. Phase 2: 単体プレイヤー実装へ進む"
echo ""
echo "📁 プロジェクトディレクトリ: $(pwd)"
echo ""

# ツリー表示（treeコマンドがある場合）
if command -v tree >/dev/null 2>&1; then
    echo "📂 プロジェクト構造:"
    tree -I '.git|.godot' -L 3
fi