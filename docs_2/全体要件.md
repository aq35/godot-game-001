# 🎮 3Dマルチプレイヤーゲーム 要件総整理

## 🌍 基本コンセプト
- **世界観**: ポケモン風の平和で美しい3D世界（ポケモンはいない）
- **プラットフォーム**: Godot 4.4
- **サーバー**: Go言語 + GraphQL
- **通信**: GraphQL（静的） + WebSocket（リアルタイム）

## 🏗️ システム全体構成

### **クライアント側（Godot）**
- 3Dキャラクター制御とレンダリング
- GraphQLクライアント + WebSocket通信
- リアルタイム同期システム
- 2D UI（設定画面、チャット等）

### **サーバー側（Go）**
- GraphQL API サーバー
- WebSocket接続管理
- 認証・セッション管理
- データベース連携

## 👥 ユーザー・キャラクター機能

### **認証システム**
- ログイン認証機能
- セッション管理
- JWT トークンベース認証

### **キャラクター選択**
- **既存モデル使用**: 細かいカスタマイズ不可
- 複数キャラクターから選択（4体程度）
- キャラクター選択の保存・復元
- 3Dプレビュー付き選択画面

### **プレイヤー名表示**
- 3D空間でのプレイヤー頭上に名前表示
- 距離による表示制御
- カメラ追従での常時正面表示

## 🌐 マルチプレイヤー機能

### **リアルタイム同期**
- **位置同期**: 座標・回転・速度
- **アニメーション同期**: 状態変化の即座同期
- **アクション同期**: 手振り、ダンス、座る等
- **移動予測**: ネットワーク遅延補償

### **同期データ**
- 位置: 100ms間隔（10fps）
- アニメーション: 状態変化時のみ
- チャット: リアルタイム送受信

## 🗺️ マップ・世界構成

### **マップ種類**
- **メインタウン**: 中央ハブエリア
- **フィールドマップ**: 森、海辺、山岳等の複数エリア
- **プライベートルーム**: 個人・グループ専用空間
- **研修ルーム**: 学習関連の専用エリア

### **マップ移動**
- シームレスなエリア移動
- ポータルシステム
- マップ間での状態保持

## 🏠 ルーム機能

### **ルーム種類**
- **パブリックルーム**: 誰でも入室可能
- **プライベートルーム**: 招待制
- **グループルーム**: 複数人共有

### **ルーム管理**
- ルーム作成・削除
- 招待・キック機能
- ルーム一覧・検索
- パスワード保護
- 権限管理（オーナー、モデレーター、メンバー、訪問者）

### **ルーム内機能**
- メンバー一覧表示
- ルーム別チャット分離
- 入退室通知

## 💬 コミュニケーション機能

### **チャット機能**
- リアルタイムメッセージング
- チャット履歴保存・表示
- ルーム別チャット分離
- システムメッセージ対応

## 🎭 アニメーション・アクション

### **自動アニメーション**
- **移動連動**: 待機→歩行→走行の自動切り替え
- **速度判定**: 移動速度によるアニメーション自動選択

### **手動アクション**
- 手を振る
- ダンス
- 座る・立つ
- ジャンプ・着地

### **アニメーション管理**
- 優先度システム
- ループ・非ループアニメーション管理
- ネットワーク同期対応

## 📚 研修システム連携

### **研修機能**
- 研修問題一覧取得
- 研修実績一覧表示
- 外部ブラウザでのURL遷移
- 進捗状況管理

### **研修データ**
- 問題一覧（GraphQL取得）
- ユーザー実績・スコア
- カテゴリ・難易度情報

## ⚙️ 設定・UI機能

### **2D設定画面**
- 音量設定（BGM・SE）
- グラフィック設定
- 操作設定
- ユーザー設定の保存・復元

### **ゲーム内UI**
- チャットパネル
- ルーム管理UI
- マップ選択メニュー
- 研修メニュー

## 🔄 データ管理

### **GraphQL（静的データ）**
- ユーザー情報・認証
- ルーム一覧・詳細情報
- 研修データ・実績
- チャット履歴（初期取得）

### **WebSocket（リアルタイムデータ）**
- プレイヤー位置・回転・速度
- アニメーション状態変更
- リアルタイムチャット
- ルームイベント（入退室・招待）
- プレイヤーアクション

### **ローカルデータ**
- ユーザー設定
- 選択キャラクター
- チャット履歴キャッシュ
- ゲーム進行状況

## 🎯 技術的制約・方針

### **パフォーマンス**
- データ送信の最適化（差分送信・閾値設定）
- ルーム単位での通信分離
- 効率的な同期頻度管理

### **セキュリティ**
- JWT認証
- ルーム権限管理
- パスワード保護

### **拡張性**
- モジュラー構成
- 新マップ・キャラクター追加容易
- 新機能追加に対応可能な設計

## 🚀 実装優先順位
1. 基礎セットアップ・認証
2. 基本キャラクター移動
3. ネットワーク基盤
4. キャラクター選択システム
5. 単一マップでのマルチプレイヤー
6. チャット機能
7. ルーム機能
8. マップ切り替え
9. 研修システム連携
10. 設定画面・UI改善

この要件整理で漏れている部分や追加したい機能はありますか？